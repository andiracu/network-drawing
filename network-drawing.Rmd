---
title: "Network drawing"
author: "Marco Mello"
date: "18/09/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=8)
```


## How to draw networks in R

[Ecological Synthesis Lab](https://marcomellolab.wordpress.com) (SintECO).

Author: Marco Mello.

E-mail: marmello@gmail.com. 

See further info in the README file.


## Summary

1. [Get ready](#ready)
2. [Package bipartite: graph](#bipgraph)
3. [Package bipartite: matrix](#bipmatrix)
4. [Package igraph: graph](#igraph)
5. [Suggested readings](#readings)


## 1. Get ready {#ready}

Load the required packages:

```{r}
library(bipartite)
library(igraph)
library(reshape2)
library(ggplot2)
library(rstudioapi)
```


Set the working directory automatically to the source file location:

```{r}
current_path <- getActiveDocumentContext()$path 
setwd(dirname(current_path ))
#print( getwd() )
```


Warnings: 

1. This script works both with binary and weighted networks.

2. This script was designed for two-mode (bipartite) networks, but some functions work also for one-mode (unipartite) networks.

3. There is no single magic way to draw all kinds of networks. There are several network drawing algorithms implemented in different R packages and stand-alone software. Study their logic and algorithms, see some papers in which they were used. Think it through, and only then decide which drawing method to use in your study. For guidelines on which drawing algorithm to choose, read the studies suggested in the end of this tutorial.


## 2. Package bipartite: graph {#bipgraph}

Create the object to be analyzed. It should be a two-mode matrix formatted for bipartite. The format is actually very simple: A tab-delimited TXT matrix with row and column labels. See the example: a network (net1) analyzed by [Bezerra et al. (2009)](http://dx.doi.org/10.1111/j.1365-2656.2009.01567.x).

```{r}
net1 <- read.table("net1.txt", head=TRUE)
```


Check whether the network loaded correctly:

```{r}
net1
```


Check the dimensions of the network:

```{r}
dim(net1)
```


Draw the graph:

```{r}
plotweb(net1, 
        
        #Set the drawing method. Experiment with other values.
        method="cca", 
        
        #Set the color of the row nodes
        col.low="lightblue",
        
        #Set the color of the column nodes
        col.high="pink", 
        
        #Set the link color
        col.interaction="grey90", 
        
        #Set the rotation of node labels
        text.rot="90", 
        
        #Set the size of node labels
        labsize=1)
```

Tip: There are many other parameters that can be set to customize the drawing. Explore them!


## 3. Package bipartite: matrix {#bipmatrix}

Use the same network as before. Just take a look at it to remember what it looks like:

```{r}
net1
```

Draw the matrix:

```{r}
visweb(net1, 
       
       #Set the drawing mode.
       type="diagonal",
       
       #Set the cell fills.
       square="interaction")
```

Tip: There are many other parameters that can be set to customize the drawing. Explore them!


## 4. Package igraph: graph {#igraph}

Transform the previous bipartite object into an igraph object:

```{r}
net2 <- graph_from_incidence_matrix(net1,
                                    #Here you inform whether it's a binary or weighted network.
                                    weighted = T) 
```

Check the network's main information:

```{r}
net2
```


#Check the vertices and edges of the igraph object:

```{r}
V(net2)
E(net2)
```


Draw the graph:

```{r}

plot.igraph(net2,
            
            # Set the drawing mode.
            # This package contains several drawing methods; try them!
            layout=layout_nicely,
            
            # Set node shapes
            vertex.shape = "circle",
            
            # Set node sizes
            vertex.size = 12,
            
            # Set link width proportional to link weights
            # You can transform the values, if they are too different or too large
            edge.width = E(net2)$weight/100,
            
            # Set node colors
            vertex.color = c("green", "yellow"),
            
            # Set link colors
            edge.color = "lightblue",
            
            # Set link curvature from 0 to 1
            edge.curved=0.3
            )
```

Tip: There are many other parameters that can be set to customize the drawing. Explore them!


## 5. Suggested readings {#readings}

1. Ognyanova K. 2017. [Static and dynamic network visualization with R](http://kateto.net/network-visualization).

2. Pocock, M. J. O., D. M. Evans, C. Fontaine, M. Harvey, R. Julliard, Ó. McLaughlin, J. Silvertown, A. Tamaddoni-Nezhad, P. C. L. White, and D. A. Bohan. (2016) [The Visualisation of Ecological Networks, and Their Use as a Tool for Engagement, Advocacy and Management](http://linkinghub.elsevier.com/retrieve/pii/S0065250415000355). In G. Woodward and D. A. Bohan (Eds.) Advances in Ecological Research. pp. 41–85, Academic Press, Cambridge.

3. Marai, G. E., B. Pinaud, K. Bühler, A. Lex, and J. H. Morris. (2019) [Ten simple rules to create biological network figures for communication](https://doi.org/10.1371/journal.pcbi.1007244). PLOS Comput. Biol. 15: e1007244.

4. Mello MAR, Muylaert RL, Pinheiro RBP & Félix GMF. 2016. [Guia para análise de redes ecológicas](https://marcomellolab.wordpress.com/software/). Edição dos autores, Belo Horizonte. 112 p. ISBN-13: 978-85-921757-0-2.

5. Barabasi, A.L. (2016) [Network Science](http://barabasi.com/networksciencebook/), 1st ed. Cambridge University Press, Cambridge.

6. Bascompte, J. & Jordano, P. (2014) [Mutualistic Networks](https://amzn.to/2FLwhto), 1st ed. Princeton University Press, Princeton.